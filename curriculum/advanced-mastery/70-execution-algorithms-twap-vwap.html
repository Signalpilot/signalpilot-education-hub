<!doctype html>
<html lang="en" dir="ltr" data-theme="dark">
<head>
  <meta charset="utf-8"/>
  <title>Execution Algorithms: TWAP, VWAP, POV, Implementation Shortfall ‚Äî Signal Pilot</title>
  <link rel="canonical" href="https://education.signalpilot.io/curriculum/advanced-mastery/70-execution-algorithms-twap-vwap.html">
  <meta name="sp-level" content="advanced-mastery"><meta name="sp-order" content="70">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,100..1000;1,9..40,100..1000&family=Gugi&family=Space+Grotesk:wght@300..700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/assets/signalpilot-theme.css">
  <link rel="stylesheet" href="/assets/edu.css">
  <link rel="stylesheet" href="/assets/notes.css">
  <link rel="stylesheet" href="/assets/auth-ui.css">
  <link rel="stylesheet" href="/assets/chatbot.css">
  <!-- Logger must load first, before other scripts that use it -->
  <script src="/assets/logger.js"></script>
  <script src="/assets/notes.js" defer></script>
  <script src="/assets/library.js"></script>
  <script src="/assets/lesson-notes.js"></script>
  <script src="/assets/quiz-enhanced.js" defer></script>
  <script src="/assets/social-share.js" defer></script>
  <script src="/assets/auth-ui.js"></script>
  <script src="/assets/supabase-client.js"></script>
  <script src="/assets/pwa-init.js"></script>
</head>
<body>
<div class="bg-stars" aria-hidden="true"></div>
<canvas id="constellations" class="sp-constellations" aria-hidden="true"></canvas>
<div class="bg-aurora" aria-hidden="true"></div>
<header class="sp-header">
  <div class="container">
    <div class="sp-branding">
      <a href="/index.html" class="logo-link" aria-label="Signal Pilot Home">
        <div class="wordmark">SIGNAL PILOT</div>
      </a>
    </div>
    <nav class="sp-nav" aria-label="Main navigation">
      <a href="/curriculum/index.html">Curriculum</a>
      <a href="/library.html">My Library</a>
    </nav>
    <button id="theme-toggle" class="theme-toggle" aria-label="Toggle theme">
      <svg class="sun-icon" width="20" height="20" viewBox="0 0 20 20" fill="currentColor"><circle cx="10" cy="10" r="3"/><path d="M10 0v3M10 17v3M20 10h-3M3 10H0M16.364 3.636l-2.121 2.121M5.757 14.243l-2.121 2.121M16.364 16.364l-2.121-2.121M5.757 5.757L3.636 3.636"/></svg>
      <svg class="moon-icon" width="20" height="20" viewBox="0 0 20 20" fill="currentColor"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"/></svg>
    </button>
  </div>
</header>
<article class="article">
  <nav class="breadcrumb" aria-label="Breadcrumb">
    <a href="/index.html">Home</a> &gt;
    <a href="/curriculum/index.html">Curriculum</a> &gt;
    <a href="/curriculum/advanced-mastery/index.html">Advanced Mastery</a> &gt;
    <span>Lesson 70</span>
  </nav>

  <div class="lesson-badges">
    <span class="badge badge-lesson">LESSON 70</span>
    <span class="badge badge-tier-advanced">ADVANCED MASTERY</span>
    <span class="badge badge-time">~45 min</span>
  </div>

  <h1>Execution Algorithms: Minimizing Slippage at Scale</h1>
  <p><b>Retail clicks "buy" and hopes for the best. Institutions deploy algorithms that execute $100M orders with 0.05% slippage.</b></p>
      <!-- Article Progress Indicator -->
      <div class="article-progress" style="--progress:0%">
        <div class="progress-circle"><span>0%</span></div>
        <div class="progress-text">
          <strong>You're making progress!</strong>
          <div style="font-size:.85rem;color:var(--muted)">Keep reading to mark this lesson complete</div>
        </div>
      </div>
  <p>Execution algorithms (algos) are the secret weapon of institutional traders. They break large orders into thousands of small pieces, time fills to minimize impact, and adapt to market conditions in real-time. This lesson teaches you how they work‚Äîand how to exploit their patterns.</p>

  <div class="progress-tracker">
    <div class="progress-step active">
      <div class="step-number">1</div>
      <div class="step-label">Why Algos</div>
    </div>
    <div class="progress-step">
      <div class="step-number">2</div>
      <div class="step-label">TWAP/VWAP</div>
    </div>
    <div class="progress-step">
      <div class="step-number">3</div>
      <div class="step-label">POV/IS</div>
    </div>
    <div class="progress-step">
      <div class="step-number">4</div>
      <div class="step-label">Advanced</div>
    </div>
    <div class="progress-step">
      <div class="step-number">5</div>
      <div class="step-label">Detection</div>
    </div>
  </div>

  <div class="callout callout-danger">
    <h4>üí∏ The $2.3M Slippage Disaster</h4>
    <p>In 2018, a portfolio manager at a mid-sized hedge fund wanted to buy 1.2M shares of a mid-cap stock (ADV = 3M shares). Instead of using a VWAP algo, he submitted a <strong>single 1.2M share market order</strong> at 9:35 AM.</p>
    <p><strong>Result:</strong> Price spiked 6.2% in 90 seconds as HFTs detected the order and front-ran. Average fill price was $0.19 higher than decision price. <strong>Total slippage cost: $228K.</strong> By 11 AM, stock had drifted back down 4% as buying pressure disappeared.</p>
    <p><strong>What he should have done:</strong> Use VWAP algo over 4-6 hours with 10% participation limit. Expected slippage: $0.02-$0.04 per share = $24K-$48K cost (5-10√ó better).</p>
  </div>

  <div class="example-block">
    <h4>Real-World Example: Lisa's $34K "No Algo" Slippage Massacre</h4>

    <p><strong>Background:</strong> Lisa, a portfolio manager at a $20M family office with a $200,000 trading account, transitioned from small retail trades (100-500 shares) to institutional-size blocks (10K-50K shares) in May 2024. Her analysis was sound‚Äîshe identified undervalued mid-cap stocks before they ran. But her execution was retail-level: she clicked "market order" for 20,000-share blocks the same way she did for 200-share trades. No TWAP, no VWAP, no participation limits, no algo execution. The result: over 4 weeks, Lisa's analysis was correct on 9 of 11 trades (82% directional accuracy), but she lost $34,200 due to slippage, market impact, and front-running. Her avg slippage: 0.9% per entry (should be 0.05-0.15% with algos). The difference between profitable and unprofitable wasn't her stock picks‚Äîit was execution mechanics at scale.</p>

    <table style="width:100%;border-collapse:collapse;margin:1rem 0;font-size:0.9rem">
      <caption style="text-align:left;font-weight:bold;margin-bottom:0.5rem">Lisa's Execution Algorithm Failures (May 2024)</caption>
      <tr style="background:rgba(255,82,82,0.15);border-bottom:2px solid rgba(255,82,82,0.3)">
        <th style="padding:0.75rem;text-align:left">Trade</th>
        <th style="padding:0.75rem;text-align:left">Lisa's Method (No Algo)</th>
        <th style="padding:0.75rem;text-align:left">What Happened</th>
        <th style="padding:0.75rem;text-align:left">Correct Algo Approach</th>
        <th style="padding:0.75rem;text-align:right">Slippage Cost</th>
      </tr>
      <tr style="border-bottom:1px solid rgba(255,82,82,0.1)">
        <td style="padding:0.75rem">AFRM<br>20,000 shares<br>ADV: 8M</td>
        <td style="padding:0.75rem"><strong>Market order 9:31 AM:</strong> "Buy 20K @ market"<br>Decision price: $28.40</td>
        <td style="padding:0.75rem">Order filled across 8 levels:<br>5K @ $28.42<br>5K @ $28.48<br>5K @ $28.54<br>5K @ $28.62<br><strong>Avg fill: $28.52 (+0.42% slippage = -$2,400)</strong><br>By 10 AM, price back to $28.38</td>
        <td style="padding:0.75rem"><strong>VWAP algo:</strong> 20K shares over 2-4 hours, max 10% participation<br>Expected slippage: 0.08% = -$450<br><span style="color:#22c55e">Saved: $1,950</span></td>
        <td style="padding:0.75rem;text-align:right"><span style="color:#ff5252">-$2,400</span></td>
      </tr>
      <tr style="border-bottom:1px solid rgba(255,82,82,0.1)">
        <td style="padding:0.75rem">UPST<br>15,000 shares<br>ADV: 4M</td>
        <td style="padding:0.75rem"><strong>Aggressive limit order:</strong> "Buy 15K @ $25.50 limit"<br>Full size visible in book</td>
        <td style="padding:0.75rem">HFT detected large order:<br>Price pumped to $25.68 before fill<br>Lisa chased @ $25.70 market<br><strong>Front-run cost: $0.20/share = -$3,000</strong><br>Price drifted to $25.45 by close</td>
        <td style="padding:0.75rem"><strong>Iceberg TWAP:</strong> Display 500 shares, hide 14,500, spread over 3 hours<br>Avg fill near $25.52<br><span style="color:#22c55e">Saved: $2,700</span></td>
        <td style="padding:0.75rem;text-align:right"><span style="color:#ff5252">-$3,000</span></td>
      </tr>
      <tr style="border-bottom:1px solid rgba(255,82,82,0.1)">
        <td style="padding:0.75rem">RBLX<br>30,000 shares<br>ADV: 12M</td>
        <td style="padding:0.75rem"><strong>Split into 3 orders:</strong> 10K @ 10:00 AM, 10K @ 11:00 AM, 10K @ 12:00 PM<br>All market orders</td>
        <td style="padding:0.75rem">Order 1: $37.20 avg (spike to $37.32)<br>Order 2: $37.48 avg (spike to $37.65)<br>Order 3: $37.72 avg (spike to $37.88)<br><strong>Lisa's buying MOVED THE MARKET up $0.52 over 2 hours</strong><br>By 2 PM: $37.25 (back down)</td>
        <td style="padding:0.75rem"><strong>VWAP algo with participation limit:</strong> 30K over 4 hours, max 8% of volume<br>Blends into natural flow, minimal impact<br>Avg fill ~$37.30<br><span style="color:#22c55e">Saved: $8,400</span></td>
        <td style="padding:0.75rem;text-align:right"><span style="color:#ff5252">-$10,200</span></td>
      </tr>
      <tr style="border-bottom:1px solid rgba(255,82,82,0.1)">
        <td style="padding:0.75rem">DKNG<br>25,000 shares<br>ADV: 15M</td>
        <td style="padding:0.75rem"><strong>Limit order @ VWAP:</strong> "Buy 25K @ $40.80 (VWAP)"<br>Hoped to get "fair price"</td>
        <td style="padding:0.75rem">VWAP at 10 AM: $40.80<br>Lisa's order sat unfilled as price moved to $41.20<br>Canceled at 2 PM, chased @ $41.35 market<br><strong>Missed VWAP by $0.55 = -$13,750 opportunity cost</strong></td>
        <td style="padding:0.75rem"><strong>VWAP algo (not limit @ VWAP!):</strong> Algorithm TRACKS VWAP dynamically, executes when price near/below<br>Fills throughout day as price crosses VWAP<br><span style="color:#22c55e">Saved: $11,000</span></td>
        <td style="padding:0.75rem;text-align:right"><span style="color:#ff5252">-$13,750</span></td>
      </tr>
      <tr style="border-bottom:1px solid rgba(255,82,82,0.1)">
        <td style="padding:0.75rem">COIN<br>10,000 shares<br>ADV: 25M</td>
        <td style="padding:0.75rem"><strong>Market order in illiquid period:</strong> 12:15 PM (lunch hour)</td>
        <td style="padding:0.75rem">ADV lunch hour = 40% of normal<br>Order consumed entire bid side:<br>3K @ $210.20<br>3K @ $210.40<br>2K @ $210.65<br>2K @ $210.90<br><strong>Avg: $210.52 (+0.61% vs decision $209.40)</strong></td>
        <td style="padding:0.75rem"><strong>Smart Router + TWAP:</strong> Avoid 12-2 PM execution, spread across morning/afternoon high-volume periods<br>Participation limit prevents exhausting liquidity<br><span style="color:#22c55e">Saved: $3,900</span></td>
        <td style="padding:0.75rem;text-align:right"><span style="color:#ff5252">-$5,100</span></td>
      </tr>
      <tr style="background:rgba(255,82,82,0.4)">
        <td colspan="4" style="padding:0.75rem;text-align:right;font-weight:bold">SELECTED SLIPPAGE COSTS (11 TRADES TOTAL):</td>
        <td style="padding:0.75rem;text-align:right;font-weight:bold"><span style="color:#ff5252">-$34,200</span></td>
      </tr>
      <tr>
        <td colspan="5" style="padding:0.75rem;font-size:0.85rem;font-style:italic">Note: Lisa's analysis was correct 82% of the time (9/11 direction), but execution slippage of 0.9% avg turned winners into losers.</td>
      </tr>
    </table>

    <h5>The Math: Slippage at Scale</h5>

    <table style="width:100%;border-collapse:collapse;margin:1rem 0;font-size:0.9rem">
      <tr style="background:rgba(255,82,82,0.15);border-bottom:2px solid rgba(255,82,82,0.3)">
        <th style="padding:0.75rem;text-align:left">Execution Method</th>
        <th style="padding:0.75rem;text-align:left">Avg Slippage</th>
        <th style="padding:0.75rem;text-align:left">Cost on $1M Order</th>
      </tr>
      <tr style="border-bottom:1px solid rgba(255,82,82,0.1)">
        <td style="padding:0.75rem"><strong>Lisa's Method:</strong> Market orders, no algo</td>
        <td style="padding:0.75rem">0.9%</td>
        <td style="padding:0.75rem"><span style="color:#ff5252">$9,000</span></td>
      </tr>
      <tr style="border-bottom:1px solid rgba(34,197,94,0.1)">
        <td style="padding:0.75rem"><strong>TWAP Algo:</strong> Time-weighted, spread evenly</td>
        <td style="padding:0.75rem">0.15-0.25%</td>
        <td style="padding:0.75rem"><span style="color:#22c55e">$1,500-$2,500</span> (6√ó better)</td>
      </tr>
      <tr style="border-bottom:1px solid rgba(34,197,94,0.1)">
        <td style="padding:0.75rem"><strong>VWAP Algo:</strong> Volume-weighted, participation limits</td>
        <td style="padding:0.75rem">0.05-0.12%</td>
        <td style="padding:0.75rem"><span style="color:#22c55e">$500-$1,200</span> (8-18√ó better)</td>
      </tr>
      <tr>
        <td style="padding:0.75rem"><strong>POV Algo:</strong> Percent-of-volume, adaptive</td>
        <td style="padding:0.75rem">0.08-0.18%</td>
        <td style="padding:0.75rem"><span style="color:#22c55e">$800-$1,800</span> (5-11√ó better)</td>
      </tr>
    </table>

    <p><strong>Lisa's Recovery (June-July 2024):</strong> After $34K in avoidable slippage, Lisa implemented execution algos: (1) <strong>VWAP algo</strong> for orders > 5,000 shares with ADV < 10M (participation limit 8-12%), (2) <strong>TWAP algo</strong> for time-sensitive entries (spread over 2-4 hours), (3) <strong>Iceberg orders</strong> for all blocks > 2,000 shares (display 10% max), (4) <strong>No execution during lunch</strong> (12-2 PM = low liquidity), (5) <strong>Smart routing</strong> across 4 venues to find best liquidity. Result: Avg slippage dropped from 0.9% to 0.11% (8√ó improvement). Over 8 weeks with 14 trades, saved $22,400 in slippage vs old method. Same analysis, 8√ó better execution.</p>

    <p><b>The lesson: Lisa's stock picking was profitable (82% direction accuracy), but retail execution at institutional scale destroyed returns. Market orders for 20,000-share blocks = 0.5-1.2% slippage instantly as HFTs front-run and liquidity exhausts. Visible full-size orders = price pumps before fill. Aggressive execution during low-volume periods = moving your own market. The difference: VWAP algo spreads 20K shares over 4 hours, blends into natural volume flow, participation limits prevent impact (8-12% of volume max), smart routing finds hidden liquidity. Result: 0.05-0.15% slippage vs 0.9% = 6-18√ó better. On $1M orders, that's $8,500 saved per trade. Execution algorithms aren't optional at scale‚Äîthey're the difference between profitable and unprofitable institutional trading. If you're trading blocks > 5,000 shares without algos, you're paying 0.5-2% unnecessarily. That's the tax of ignorance.</b></p>
  </div>

  
      <!-- TL;DR Skimmer Summary -->
      <details style="background:rgba(0,212,170,0.08);padding:1.5rem;border-radius:8px;margin:2rem 0;border-left:4px solid #00d4aa">
        <summary style="cursor:pointer;font-weight:600;font-size:1.1rem">‚ö° TL;DR - 3-Minute Summary (Click to expand)</summary>
        <div style="margin-top:1rem">
          <h4 style="margin:0 0 0.75rem 0">What You'll Learn:</h4>
          <ul style="line-height:1.8;margin:0 0 1rem 1.5rem">
      <li>TWAP = constant rate execution (simple but ignores volume)</li>
      <li>VWAP = volume-proportional execution (lower impact, institutional standard)</li>
      <li>POV = % of market volume (adaptive to liquidity conditions)</li>
          </ul>
          <h4 style="margin:1rem 0 0.75rem 0">Action Items:</h4>
          <ol style="line-height:1.8;margin:0 0 0 1.5rem">
      <li>Strong conviction: PM's analysis was correct‚ÄîAMD rallied 1% from decision time to close</li>
      <li>Early aggression: IS algo locked in 40% of order at $145.08 (8 cents above decision price)</li>
          </ol>
          <p style="margin-top:1rem;font-size:0.9rem;color:var(--muted)"><em>Read the full lesson for case studies, detailed examples, and common mistakes to avoid.</em></p>
        </div>
      </details>


<h2>Part 1: Why Execution Algos Exist</h2>

  <h3>The Large Order Problem</h3>
  <p><strong>Scenario:</strong> Hedge fund wants to buy 500,000 shares of AAPL (ADV = 50M)</p>
  <p><strong>Naive approach:</strong> Submit 500K market order ‚Üí price jumps 0.5-1% ‚Üí slippage cost = $250K-$500K</p>
  <p><strong>Smart approach:</strong> Use VWAP algo to execute over 4 hours ‚Üí slippage = 0.05% ‚Üí cost = $25K (10-20√ó better)</p>

  <div class="callout">
    <p><strong>üìä Scale:</strong> At $150/share, 500K shares = $75M order. Saving 0.5% slippage = $375,000. This is why institutions invest millions in execution technology.</p>
  </div>

  <h3>The Trade-Off: Speed vs Impact</h3>
  <table>
    <thead>
      <tr>
        <th>Execution Speed</th>
        <th>Market Impact</th>
        <th>Execution Risk</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>Immediate (market order)</td>
        <td>High (1-5%)</td>
        <td>Low (no drift)</td>
      </tr>
      <tr>
        <td>Fast (1 hour)</td>
        <td>Medium (0.2-0.5%)</td>
        <td>Medium (some drift)</td>
      </tr>
      <tr>
        <td>Slow (full day)</td>
        <td>Low (0.05-0.1%)</td>
        <td>High (price might move away)</td>
      </tr>
    </tbody>
  </table>

  <h2>Part 2: TWAP (Time-Weighted Average Price)</h2>

  <h3>How TWAP Works</h3>
  <p><strong>Concept:</strong> Split order evenly across time (constant rate)</p>
  <p><strong>Formula:</strong> Trade Size = Total Order / Time Slices</p>

  <p><strong>Example:</strong></p>
  <ul>
    <li>Order: Buy 120,000 shares</li>
    <li>Duration: 9:30 AM - 3:30 PM (6 hours = 360 minutes)</li>
    <li>TWAP rate: 120,000 / 360 = 333 shares/minute</li>
  </ul>

  <p><strong>Execution pattern:</strong> Every minute, algo submits limit order for 333 shares at or near current price</p>

  <h3>TWAP Advantages</h3>
  <ul>
    <li><strong>Simple:</strong> Easy to explain to compliance/clients ("we traded evenly all day")</li>
    <li><strong>Predictable:</strong> Execution rate is constant</li>
    <li><strong>Low footprint:</strong> Small slices don't move market</li>
  </ul>

  <h3>TWAP Disadvantages</h3>
  <ul>
    <li><strong>Ignores volume:</strong> Trades same amount during lunch (low volume) as during open (high volume)</li>
    <li><strong>Suboptimal:</strong> High impact during low-volume periods</li>
    <li><strong>Detectable:</strong> HFTs can identify TWAP patterns and front-run</li>
  </ul>

  <div class="example-block">
    <h4>Real-World Example: TWAP Execution Breakdown</h4>
    <p><strong>Scenario:</strong> Mutual fund needs to sell 360,000 shares of MSFT (current price $380.00, avg daily volume 20M shares)</p>

    <p><strong>TWAP Parameters:</strong></p>
    <ul>
      <li><strong>Duration:</strong> 9:30 AM - 3:30 PM (6 hours = 360 minutes)</li>
      <li><strong>Execution rate:</strong> 360,000 shares / 360 minutes = 1,000 shares/minute</li>
      <li><strong>Slice size:</strong> 250 shares every 15 seconds (4 slices/minute = 1,000 shares/minute)</li>
    </ul>

    <p><strong>Hourly Execution Log:</strong></p>
    <table>
      <thead>
        <tr>
          <th>Hour</th>
          <th>Target Shares</th>
          <th>Actual Filled</th>
          <th>Avg Price</th>
          <th>Market Volume</th>
          <th>Our % of Volume</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>9:30-10:30</td>
          <td>60,000</td>
          <td>59,850</td>
          <td>$380.05</td>
          <td>4.2M shares</td>
          <td>1.4%</td>
        </tr>
        <tr>
          <td>10:30-11:30</td>
          <td>60,000</td>
          <td>60,100</td>
          <td>$379.95</td>
          <td>3.1M shares</td>
          <td>1.9%</td>
        </tr>
        <tr>
          <td>11:30-12:30</td>
          <td>60,000</td>
          <td>59,200</td>
          <td>$379.85</td>
          <td>1.8M shares</td>
          <td><strong>3.3%</strong> (high impact)</td>
        </tr>
        <tr>
          <td>12:30-1:30</td>
          <td>60,000</td>
          <td>58,950</td>
          <td>$379.75</td>
          <td>1.5M shares</td>
          <td><strong>3.9%</strong> (very high impact)</td>
        </tr>
        <tr>
          <td>1:30-2:30</td>
          <td>60,000</td>
          <td>60,200</td>
          <td>$379.90</td>
          <td>2.8M shares</td>
          <td>2.1%</td>
        </tr>
        <tr>
          <td>2:30-3:30</td>
          <td>60,000</td>
          <td>60,700</td>
          <td>$380.10</td>
          <td>5.6M shares</td>
          <td>1.1%</td>
        </tr>
      </tbody>
    </table>

    <p><strong>Performance Analysis:</strong></p>
    <table>
      <thead>
        <tr>
          <th>Metric</th>
          <th>Value</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>Total Filled</td>
          <td>359,000 shares (99.7%)</td>
        </tr>
        <tr>
          <td>Average Fill Price</td>
          <td>$379.93</td>
        </tr>
        <tr>
          <td>Decision Price (9:30 AM)</td>
          <td>$380.00</td>
        </tr>
        <tr>
          <td>Performance vs Decision</td>
          <td>+$0.07 (beat by 7 cents)</td>
        </tr>
        <tr>
          <td>Daily VWAP</td>
          <td>$380.08</td>
        </tr>
        <tr>
          <td>Performance vs VWAP</td>
          <td>+$0.15 (beat by 15 cents)</td>
        </tr>
      </tbody>
    </table>

    <p><strong>The Problem with TWAP:</strong></p>
    <ul>
      <li>During lunch (11:30 AM - 1:30 PM), algo was 3-4% of market volume despite low liquidity</li>
      <li>This caused price depression (our selling moved price down $0.10-$0.15 during low-vol periods)</li>
      <li>If we used <strong>VWAP instead</strong>, would have traded only 15-20% of order during lunch (18K shares vs 120K), reducing impact</li>
      <li>Total slippage: ~$25K (could have saved $15K-$20K with VWAP)</li>
    </ul>

    <p><strong>When TWAP Still Makes Sense:</strong></p>
    <ul>
      <li>Very liquid stocks where 1% participation has minimal impact (SPY, AAPL, MSFT with small orders)</li>
      <li>Simple compliance requirement ("execute evenly throughout day")</li>
      <li>Orders &lt; 0.5% of daily volume (impact negligible regardless of timing)</li>
    </ul>
  </div>

  <h2>Part 3: VWAP (Volume-Weighted Average Price)</h2>

  <h3>How VWAP Works</h3>
  <p><strong>Concept:</strong> Trade in proportion to market volume (more during high-volume, less during low-volume)</p>
  <p><strong>Goal:</strong> Match the market's volume distribution ‚Üí achieve average execution price close to VWAP</p>

  <h3>VWAP Calculation</h3>
  <p><strong>Market VWAP = Œ£ (Price √ó Volume) / Œ£ Volume</strong></p>

  <p><strong>Example:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Time</th>
        <th>Price</th>
        <th>Volume</th>
        <th>Price √ó Volume</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>9:30-10:00</td>
        <td>$150.00</td>
        <td>5M</td>
        <td>$750M</td>
      </tr>
      <tr>
        <td>10:00-11:00</td>
        <td>$150.20</td>
        <td>8M</td>
        <td>$1,201.6M</td>
      </tr>
      <tr>
        <td>11:00-12:00</td>
        <td>$150.10</td>
        <td>4M</td>
        <td>$600.4M</td>
      </tr>
    </tbody>
  </table>

  <p><strong>VWAP = ($750M + $1,201.6M + $600.4M) / (5M + 8M + 4M) = $2,552M / 17M = $150.12</strong></p>

  <h3>VWAP Algo Execution Strategy</h3>

  <details class="accordion">
    <summary>Step-by-Step VWAP Execution</summary>
    <div class="accordion-content">
      <p><strong>Step 1: Forecast volume distribution</strong></p>
      <ul>
        <li>Analyze historical volume patterns (e.g., 9:30-10:00 = 15% of daily volume)</li>
        <li>Adjust for current conditions (earnings day = higher volume)</li>
      </ul>

      <p><strong>Step 2: Allocate order to time buckets</strong></p>
      <ul>
        <li>Order: 100K shares</li>
        <li>9:30-10:00 forecast: 15% of volume ‚Üí trade 15K shares (15% of order)</li>
        <li>10:00-11:00 forecast: 20% of volume ‚Üí trade 20K shares</li>
        <li>And so on...</li>
      </ul>

      <p><strong>Step 3: Execute within each bucket</strong></p>
      <ul>
        <li>During 9:30-10:00, trade 15K shares at constant rate (500 shares/minute)</li>
        <li>OR adapt in real-time (if volume surges, trade faster; if volume dries up, slow down)</li>
      </ul>

      <p><strong>Step 4: Measure performance</strong></p>
      <ul>
        <li>If your avg fill = $150.10 and market VWAP = $150.12 ‚Üí you beat VWAP by $0.02 (good execution)</li>
        <li>If your avg fill = $150.20 ‚Üí you lagged VWAP by $0.08 (poor execution, algo too aggressive)</li>
      </ul>
    </div>
  </details>

  <h3>VWAP vs TWAP Comparison</h3>
  <table>
    <thead>
      <tr>
        <th>Feature</th>
        <th>TWAP</th>
        <th>VWAP</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>Execution rate</td>
        <td>Constant</td>
        <td>Varies with volume</td>
      </tr>
      <tr>
        <td>Complexity</td>
        <td>Simple</td>
        <td>Requires volume forecasting</td>
      </tr>
      <tr>
        <td>Market impact</td>
        <td>Higher (trades during low-vol periods)</td>
        <td>Lower (trades more when liquidity high)</td>
      </tr>
      <tr>
        <td>Use case</td>
        <td>Small orders, simple execution</td>
        <td>Large orders, minimize slippage</td>
      </tr>
      <tr>
        <td>Benchmark</td>
        <td>Time-weighted avg price</td>
        <td>Volume-weighted avg price</td>
      </tr>
    </tbody>
  </table>

  <h2>Part 4: POV (Percentage of Volume)</h2>

  <h3>How POV Works</h3>
  <p><strong>Concept:</strong> Trade as fixed % of market volume (participation rate)</p>
  <p><strong>Example:</strong> POV 10% ‚Üí if market trades 1,000 shares/minute, algo trades 100 shares/minute</p>

  <h3>POV Execution Behavior</h3>
  <p><strong>High volume period:</strong> Market trading 5,000 shares/min ‚Üí POV trades 500 shares/min</p>
  <p><strong>Low volume period:</strong> Market trading 500 shares/min ‚Üí POV trades 50 shares/min</p>
  <p><strong>Result:</strong> Algo automatically slows during illiquid periods, speeds up during liquid periods</p>

  <h3>POV Settings</h3>
  <ul>
    <li><strong>Conservative POV (5-10%):</strong> Low market impact, slow fill rate</li>
    <li><strong>Moderate POV (10-20%):</strong> Balanced</li>
    <li><strong>Aggressive POV (20-30%):</strong> Fast fill, higher impact (risk of being detected)</li>
  </ul>

  <div class="callout">
    <p><strong>‚ö†Ô∏è POV Risk:</strong> In low-volume stocks, POV can fail to complete order if volume dries up. Set maximum duration (e.g., "POV 10% but finish in 4 hours no matter what").</p>
  </div>

  <h2>Part 5: Implementation Shortfall (IS)</h2>

  <h3>The IS Problem</h3>
  <p><strong>Scenario:</strong> Portfolio manager decides to buy AAPL at 10:00 AM (decision price = $150.00)</p>
  <p><strong>Execution completes at 2:00 PM (avg fill = $150.40)</strong></p>
  <p><strong>Implementation shortfall = $0.40/share = cost of delaying execution</strong></p>

  <h3>IS Algo Strategy</h3>
  <p><strong>Goal:</strong> Minimize difference between decision price and final execution price</p>
  <p><strong>Approach:</strong></p>
  <ul>
    <li><strong>Phase 1 (first 20%):</strong> Trade aggressively (lock in current price, high urgency)</li>
    <li><strong>Phase 2 (next 60%):</strong> Trade patiently (reduce market impact, VWAP-style)</li>
    <li><strong>Phase 3 (final 20%):</strong> Increase urgency if lagging (ensure completion)</li>
  </ul>

  <div class="example-block">
    <h4>Real-World Example: Implementation Shortfall vs VWAP</h4>
    <p><strong>Scenario:</strong> Hedge fund PM sees bullish setup in AMD at 2:00 PM. Decision price: $145.00. Order: buy 200,000 shares.</p>

    <p><strong>Two Execution Strategies Compared:</strong></p>

    <h5>Strategy A: VWAP Algo (Standard Approach)</h5>
    <table>
      <thead>
        <tr>
          <th>Time</th>
          <th>Shares Filled</th>
          <th>Cumulative</th>
          <th>Avg Price</th>
          <th>Market Price</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>2:00-2:30</td>
          <td>30,000</td>
          <td>30K</td>
          <td>$145.15</td>
          <td>$145.20</td>
        </tr>
        <tr>
          <td>2:30-3:00</td>
          <td>40,000</td>
          <td>70K</td>
          <td>$145.40</td>
          <td>$145.55</td>
        </tr>
        <tr>
          <td>3:00-3:30</td>
          <td>50,000</td>
          <td>120K</td>
          <td>$145.80</td>
          <td>$146.05</td>
        </tr>
        <tr>
          <td>3:30-4:00</td>
          <td>80,000</td>
          <td>200K</td>
          <td>$146.20</td>
          <td>$146.50</td>
        </tr>
      </tbody>
    </table>
    <p><strong>VWAP Result:</strong> Avg fill = $145.72. Implementation shortfall = $0.72/share = <strong>$144K slippage</strong></p>

    <h5>Strategy B: IS Algo (Aggressive Start)</h5>
    <table>
      <thead>
        <tr>
          <th>Time</th>
          <th>Shares Filled</th>
          <th>Cumulative</th>
          <th>Avg Price</th>
          <th>Market Price</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>2:00-2:15</td>
          <td><strong>80,000</strong></td>
          <td>80K</td>
          <td>$145.08</td>
          <td>$145.15</td>
        </tr>
        <tr>
          <td>2:15-2:45</td>
          <td>60,000</td>
          <td>140K</td>
          <td>$145.35</td>
          <td>$145.50</td>
        </tr>
        <tr>
          <td>2:45-3:15</td>
          <td>40,000</td>
          <td>180K</td>
          <td>$145.70</td>
          <td>$145.90</td>
        </tr>
        <tr>
          <td>3:15-3:35</td>
          <td>20,000</td>
          <td>200K</td>
          <td>$146.05</td>
          <td>$146.25</td>
        </tr>
      </tbody>
    </table>
    <p><strong>IS Result:</strong> Avg fill = $145.28. Implementation shortfall = $0.28/share = <strong>$56K slippage</strong></p>

    <p><strong>Comparison:</strong></p>
    <table>
      <thead>
        <tr>
          <th>Metric</th>
          <th>VWAP</th>
          <th>IS Algo</th>
          <th>Difference</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>Avg Fill Price</td>
          <td>$145.72</td>
          <td>$145.28</td>
          <td><strong>$0.44 better</strong></td>
        </tr>
        <tr>
          <td>Total Slippage Cost</td>
          <td>$144,000</td>
          <td>$56,000</td>
          <td><strong>$88K savings</strong></td>
        </tr>
        <tr>
          <td>% Filled in First 30 Min</td>
          <td>30K (15%)</td>
          <td>80K (40%)</td>
          <td>+25% faster start</td>
        </tr>
        <tr>
          <td>Market Impact</td>
          <td>Low</td>
          <td>Medium</td>
          <td>Slightly higher</td>
        </tr>
      </tbody>
    </table>

    <p><strong>Why IS Outperformed:</strong></p>
    <ol>
      <li><strong>Strong conviction:</strong> PM's analysis was correct‚ÄîAMD rallied 1% from decision time to close</li>
      <li><strong>Early aggression:</strong> IS algo locked in 40% of order at $145.08 (8 cents above decision price)</li>
      <li><strong>Avoided chasing:</strong> VWAP spread order evenly, forcing fills at $146+ as rally accelerated</li>
      <li><strong>Adaptive pacing:</strong> IS slowed down after locking early, reduced impact during rally</li>
    </ol>

    <p><strong>When IS Fails:</strong></p>
    <ul>
      <li><strong>False breakout:</strong> If AMD reversed after 2:15 PM and fell to $144, IS would have overpaid early</li>
      <li><strong>Wrong directional view:</strong> IS assumes you're RIGHT about near-term direction. If wrong, aggressive start = losses.</li>
      <li><strong>Choppy markets:</strong> In sideways action, VWAP's patient approach outperforms IS</li>
    </ul>

    <p><strong>Use IS When:</strong></p>
    <ul>
      <li>High conviction directional trade (strong catalyst, breakout, news)</li>
      <li>Momentum accelerating (don't want price to run away)</li>
      <li>Time-sensitive (must be filled before close, event, etc.)</li>
    </ul>
  </div>

  <h3>IS vs VWAP</h3>
  <table>
    <thead>
      <tr>
        <th>Algo</th>
        <th>Benchmark</th>
        <th>Best For</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>VWAP</td>
        <td>Match market's volume-weighted price</td>
        <td>Passive execution (no view on direction)</td>
      </tr>
      <tr>
        <td>IS</td>
        <td>Minimize slippage from decision price</td>
        <td>Active conviction (don't want price to run away)</td>
      </tr>
    </tbody>
  </table>

  <h2>Part 6: Adaptive Algos (Next Generation)</h2>

  <h3>Smart Order Routing (SOR)</h3>
  <p><strong>Problem:</strong> Stock trades on 13+ exchanges (NYSE, Nasdaq, BATS, IEX, etc.)</p>
  <p><strong>Solution:</strong> SOR algo routes each slice to venue with best price + lowest fees</p>
  <p><strong>Example:</strong> NYSE bid = $100.00, IEX bid = $100.01 ‚Üí SOR sells on IEX (extra $0.01/share)</p>

  <h3>Machine Learning Algos</h3>
  <p><strong>Concept:</strong> Use ML to predict short-term price movement and volume, adapt execution in real-time</p>
  <p><strong>Example:</strong> ML detects momentum acceleration ‚Üí algo speeds up execution to front-run trend</p>
  <p><strong>Risk:</strong> Overfitting (algo works in backtest, fails live)</p>

  <h2>Part 7: Detecting Algos with Signal Pilot</h2>

  <h3>Pentarch Pilot Line: VWAP Signature</h3>
  <p><strong>Pattern:</strong> Steady, consistent buying over 2-4 hours (no sudden bursts)</p>
  <p><strong>Volume proportionality:</strong> More buying during high-volume periods (9:30-11 AM, 2-4 PM)</p>
  <p><strong>Signal:</strong> VWAP algo executing ‚Üí institutional planned order (not discretionary conviction trade)</p>

  <h3>Minimal Flow: TWAP Signature</h3>
  <p><strong>Pattern:</strong> Identical-sized prints at regular intervals (e.g., 300 shares every 2 minutes)</p>
  <p><strong>Clock-like precision:</strong> Prints at :02, :04, :06, :08 (every 2 mins)</p>
  <p><strong>Signal:</strong> TWAP algo ‚Üí less sophisticated execution (older algo or small institution)</p>

  <h3>Harmonic Oscillator: Algo Fatigue Detection</h3>
  <p><strong>Pattern:</strong> VWAP buying for 3 hours, then stops abruptly</p>
  <p><strong>Implication:</strong> Algo finished, no more buying pressure ‚Üí potential reversal</p>

  <h2>Quiz: Test Your Understanding</h2>
  <div class="quiz">
    <div class="quiz-question">
      <p><strong>Q1:</strong> You need to buy 100K shares. Market VWAP forecast: 9:30-10 AM = 20% of volume. How many shares should you target during that period?</p>
      <details>
        <summary>Show Answer</summary>
        <p><strong>Answer:</strong> 20,000 shares (20% of 100K). VWAP algo allocates order proportionally to forecasted volume. If 20% of daily volume occurs 9:30-10 AM, trade 20% of your order during that time.</p>
      </details>
    </div>

    <div class="quiz-question">
      <p><strong>Q2:</strong> TWAP vs VWAP: Which has lower market impact and why?</p>
      <details>
        <summary>Show Answer</summary>
        <p><strong>Answer:</strong> VWAP has lower impact. TWAP trades constant rate (same amount during low-volume lunch as high-volume open ‚Üí higher impact during lunch). VWAP adapts to volume (trades more when liquidity is high ‚Üí lower average impact).</p>
      </details>
    </div>

    <div class="quiz-question">
      <p><strong>Q3:</strong> You detect VWAP buying pattern in AAPL for 3 hours. At 1:00 PM, buying stops. What's your trade?</p>
      <details>
        <summary>Show Answer</summary>
        <p><strong>Answer:</strong> Algo finished executing ‚Üí buying pressure removed. If price was rising on algo buying, expect pullback/consolidation now that support is gone. Consider taking profits on longs or initiating small short position.</p>
      </details>
    </div>
  </div>

  <h2>Practice Exercise: Algo Selection & Detection</h2>

  <div class="practice-section">
    <h3>Exercise 1: Choose the Right Algo</h3>
    <p><strong>Goal:</strong> Given trading scenarios, select optimal execution algorithm and parameters.</p>

    <p><strong>Scenario A:</strong> You need to buy 450K shares of COST (Costco). Current price: $520. Avg daily volume: 2.5M shares. No urgency, want best execution price. Which algo?</p>
    <details>
      <summary>Show Answer</summary>
      <p><strong>Answer: VWAP algo over full day (9:30 AM - 4:00 PM) with 10% participation limit.</strong></p>
      <p><strong>Rationale:</strong></p>
      <ul>
        <li>450K shares = 18% of daily volume (large order)</li>
        <li>VWAP adapts to volume patterns ‚Üí lower impact than TWAP</li>
        <li>Full-day execution spreads order to ~3% per hour (manageable)</li>
        <li>10% participation prevents dominating tape during low-volume periods</li>
        <li>Expected slippage: 0.05-0.10% ($260-520 per share = $117K-234K total)</li>
      </ul>
      <p><strong>Why not alternatives?</strong></p>
      <ul>
        <li><strong>TWAP:</strong> Would create 3-5% impact during lunch lull (suboptimal)</li>
        <li><strong>IS algo:</strong> No urgency or directional conviction (not needed)</li>
        <li><strong>POV 5%:</strong> Too slow, might take 2+ days to fill (execution risk)</li>
      </ul>
    </details>

    <p><strong>Scenario B:</strong> Bullish earnings report just released for NVDA at 4:05 PM. You want to buy 150K shares at open tomorrow (conviction trade, expect gap up). Which algo?</p>
    <details>
      <summary>Show Answer</summary>
      <p><strong>Answer: Implementation Shortfall (IS) algo, 50% in first 30 minutes, complete within 2 hours.</strong></p>
      <p><strong>Rationale:</strong></p>
      <ul>
        <li>High conviction + catalyst = expect price to run away</li>
        <li>IS locks in decision price quickly (aggressive start)</li>
        <li>First 30 min: fill 75K shares (50%) at near-opening price</li>
        <li>Next 90 min: fill remaining 75K more patiently</li>
        <li>Risk: If you're wrong, aggressive start = overpaid. But conviction justifies risk.</li>
      </ul>
      <p><strong>Why not VWAP?</strong> VWAP spreads order evenly ‚Üí if stock gaps up 3-5%, you'll be chasing all day and average $4-8 worse price.</p>
    </details>

    <p><strong>Scenario C:</strong> You detect TWAP buying in SHOP: 400 shares every 90 seconds for past 2 hours. What's your trade?</p>
    <details>
      <summary>Show Answer</summary>
      <p><strong>Answer: Buy SHOP now, hold until TWAP algo completes, then exit.</strong></p>
      <p><strong>Rationale:</strong></p>
      <ul>
        <li>TWAP = institutional planned order (rebalancing, passive flow)</li>
        <li>400 shares/90 sec = 16K shares/hour. If 2 hours so far, likely 50-100K total order</li>
        <li>Estimate 1-2 more hours of buying (constant support)</li>
        <li>When algo stops (no more 400-share prints), buying pressure removed ‚Üí expect pullback</li>
      </ul>
      <p><strong>Entry:</strong> Buy at current price. <strong>Exit:</strong> When TWAP pattern breaks (no 400-share print for 5+ minutes).</p>
    </details>
  </div>

  <div class="practice-section">
    <h3>Exercise 2: Calculate Algo Performance</h3>
    <p><strong>Scenario:</strong> You executed 200K share buy order using VWAP algo. Calculate performance vs benchmark.</p>

    <p><strong>Your Execution:</strong></p>
    <ul>
      <li>9:30-10:30: Bought 40K shares at avg $100.15</li>
      <li>10:30-12:00: Bought 60K shares at avg $100.25</li>
      <li>12:00-2:00: Bought 50K shares at avg $100.10</li>
      <li>2:00-4:00: Bought 50K shares at avg $100.30</li>
    </ul>

    <p><strong>Market VWAP for the day: $100.22</strong></p>

    <p><strong>Questions:</strong></p>
    <ol>
      <li>What was your volume-weighted average fill price?</li>
      <li>Did you beat or lag VWAP? By how much?</li>
      <li>Total savings/cost vs VWAP benchmark?</li>
    </ol>

    <details>
      <summary>Show Answer</summary>
      <p><strong>1. Your VWAP calculation:</strong></p>
      <ul>
        <li>(40K √ó $100.15) + (60K √ó $100.25) + (50K √ó $100.10) + (50K √ó $100.30) = Total $ spent</li>
        <li>= $4,006K + $6,015K + $5,005K + $5,015K = $20,041K</li>
        <li>Your avg price = $20,041K / 200K shares = <strong>$100.205</strong></li>
      </ul>
      <p><strong>2. Performance vs VWAP:</strong></p>
      <ul>
        <li>Market VWAP = $100.22</li>
        <li>Your avg = $100.205</li>
        <li><strong>Beat VWAP by $0.015 (1.5 cents)</strong></li>
      </ul>
      <p><strong>3. Total savings:</strong></p>
      <ul>
        <li>$0.015 √ó 200,000 shares = <strong>$3,000 saved</strong></li>
      </ul>
      <p><strong>Interpretation:</strong> Good execution. You beat VWAP by weighting fills toward lower-price periods (12:00-2:00 PM at $100.10). This is optimal algo behavior.</p>
    </details>
  </div>

  <h2>Practical Checklist</h2>
  <div class="checklist">
    <h4>Choosing Execution Algo:</h4>
    <ul>
      <li>Order &lt; 1% ADV: Use simple limit orders (no algo needed)</li>
      <li>Order 1-5% ADV: Use VWAP (minimize impact, execute over 2-4 hours)</li>
      <li>Order &gt; 5% ADV: Use POV 5-10% (very patient, spread over full day)</li>
      <li>High conviction trade: Use IS algo (lock in decision price quickly)</li>
      <li>Illiquid stock: Use POV with max duration cap (prevent getting stuck)</li>
    </ul>
    <h4>Detecting Institutional Algos:</h4>
    <ul>
      <li>Use Signal Pilot Pentarch Pilot Line to spot VWAP patterns (steady 2-4 hour flow)</li>
      <li>Use Minimal Flow to detect TWAP (identical prints at regular intervals)</li>
      <li>When algo stops (flow disappears), expect price reversion or consolidation</li>
      <li>If algo buying accelerates (POV increasing), trend strengthening</li>
    </ul>
  </div>

  <div class="key-takeaway">
    <h4>Key Takeaways</h4>
    <ul>
      <li><strong>TWAP = constant rate execution</strong> (simple but ignores volume)</li>
      <li><strong>VWAP = volume-proportional execution</strong> (lower impact, institutional standard)</li>
      <li><strong>POV = % of market volume</strong> (adaptive to liquidity conditions)</li>
      <li><strong>IS = minimize slippage from decision price</strong> (high-conviction trades)</li>
      <li><strong>Detect algos via Signal Pilot:</strong> VWAP = steady flow, TWAP = clock-like prints</li>
    </ul>
  </div>

  <div class="related-lessons">
    <h4>Related Lessons</h4>
    <ul>
      <li><a href="65-market-impact-models.html">Lesson 65: Market Impact Models</a></li>
      <li><a href="69-institutional-order-types.html">Lesson 69: Institutional Order Types</a></li>
      <li><a href="/curriculum/intermediate-bridge/45-auction-theory-imbalances.html">Lesson 45: Auction Theory & Market Imbalances</a></li>
    </ul>
  </div>

  <div class="downloads">
    <h4>Downloads</h4>
    <ul>
      <li><a href="/downloads/execution-algo-selection-guide.pdf">Execution Algo Selection Guide (PDF)</a></li>
      <li><a href="/downloads/vwap-calculation-template.xlsx">VWAP Calculation Template (Excel)</a></li>
    </ul>
  </div>
</article>
<aside class="toc">
  <h3>On this page</h3>
  <ul>
    <li><a href="#part-1-why-execution-algos-exist">Part 1: Why Execution Algos Exist</a></li>
    <li><a href="#part-2-twap-time-weighted-average-price">Part 2: TWAP (Time-Weighted Average Price)</a></li>
    <li><a href="#part-3-vwap-volume-weighted-average-price">Part 3: VWAP (Volume-Weighted Average Price)</a></li>
    <li><a href="#part-4-pov-percentage-of-volume">Part 4: POV (Percentage of Volume)</a></li>
    <li><a href="#part-5-implementation-shortfall-is">Part 5: Implementation Shortfall (IS)</a></li>
    <li><a href="#part-6-adaptive-algos-next-generation">Part 6: Adaptive Algos (Next Generation)</a></li>
    <li><a href="#part-7-detecting-algos-with-signal-pilot">Part 7: Detecting Algos with Signal Pilot</a></li>
    <li><a href="#quiz-test-your-understanding">Quiz: Test Your Understanding</a></li>
  </ul>
</aside>
<footer class="sp-footer">
  <div class="container">
    <p>&copy; 2025 Signal Pilot Labs, Inc. All rights reserved.</p>
  </div>
</footer>
<script src="/assets/edu.js"></script>
<script src="/assets/edu-enhanced.js"></script>
<script>
document.getElementById('theme-toggle')?.addEventListener('click', () => {
  const html = document.documentElement;
  const currentTheme = html.getAttribute('data-theme');
  html.setAttribute('data-theme', currentTheme === 'dark' ? 'light' : 'dark');
});
const canvas = document.getElementById('constellations');
if (canvas) {
  const ctx = canvas.getContext('2d');
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
  const stars = Array.from({ length: 80 }, () => ({
    x: Math.random() * canvas.width,
    y: Math.random() * canvas.height,
    vx: (Math.random() - 0.5) * 0.2,
    vy: (Math.random() - 0.5) * 0.2
  }));
  function drawConstellations() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.strokeStyle = 'rgba(139, 92, 246, 0.15)';
    ctx.lineWidth = 1;
    for (let i = 0; i < stars.length; i++) {
      for (let j = i + 1; j < stars.length; j++) {
        const dx = stars[i].x - stars[j].x;
        const dy = stars[i].y - stars[j].y;
        const dist = Math.sqrt(dx * dx + dy * dy);
        if (dist < 150) {
          ctx.beginPath();
          ctx.moveTo(stars[i].x, stars[i].y);
          ctx.lineTo(stars[j].x, stars[j].y);
          ctx.stroke();
        }
      }
      stars[i].x += stars[i].vx;
      stars[i].y += stars[i].vy;
      if (stars[i].x < 0 || stars[i].x > canvas.width) stars[i].vx *= -1;
      if (stars[i].y < 0 || stars[i].y > canvas.height) stars[i].vy *= -1;
    }
    requestAnimationFrame(drawConstellations);
  }
  drawConstellations();
  window.addEventListener('resize', () => {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
  });
}
</script>
</body>
</html>