<!doctype html>
<html lang="en" dir="ltr" data-theme="dark">
<head>
  <meta charset="utf-8"/>
  <title>Portfolio Construction & Kelly Criterion: Optimal Capital Allocation ‚Äî Signal Pilot</title>
  <link rel="canonical" href="https://education.signalpilot.io/curriculum/intermediate-bridge/47-portfolio-construction-kelly.html">
  <meta name="sp-level" content="intermediate-bridge"><meta name="sp-order" content="47">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,100..1000;1,9..40,100..1000&family=Gugi&family=Space+Grotesk:wght@300..700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/assets/signalpilot-theme.css">
  <link rel="stylesheet" href="/assets/edu.css">
  <link rel="stylesheet" href="/assets/notes.css">
  <link rel="stylesheet" href="/assets/auth-ui.css">
  <link rel="stylesheet" href="/assets/chatbot.css">
  <!-- Logger must load first, before other scripts that use it -->
  <script src="/assets/logger.js"></script>
  <script src="/assets/notes.js" defer></script>
  <script src="/assets/library.js"></script>
  <script src="/assets/lesson-notes.js"></script>
  <script src="/assets/quiz-enhanced.js" defer></script>
  <script src="/assets/social-share.js" defer></script>
  <script src="/assets/auth-ui.js"></script>
  <script src="/assets/supabase-client.js"></script>
  <script src="/assets/pwa-init.js"></script>
</head>
<body>
<div class="bg-stars" aria-hidden="true"></div>
<canvas id="constellations" class="sp-constellations" aria-hidden="true"></canvas>
<div class="bg-aurora" aria-hidden="true"></div>
<header class="sp-header">
  <div class="container">
    <div class="sp-branding">
      <a href="/index.html" class="logo-link" aria-label="Signal Pilot Home">
        <div class="wordmark">SIGNAL PILOT</div>
      </a>
    </div>
    <nav class="sp-nav" aria-label="Main navigation">
      <a href="/curriculum/index.html">Curriculum</a>
      <a href="/library.html">My Library</a>
    </nav>
    <button id="theme-toggle" class="theme-toggle" aria-label="Toggle theme">
      <svg class="sun-icon" width="20" height="20" viewBox="0 0 20 20" fill="currentColor"><circle cx="10" cy="10" r="3"/><path d="M10 0v3M10 17v3M20 10h-3M3 10H0M16.364 3.636l-2.121 2.121M5.757 14.243l-2.121 2.121M16.364 16.364l-2.121-2.121M5.757 5.757L3.636 3.636"/></svg>
      <svg class="moon-icon" width="20" height="20" viewBox="0 0 20 20" fill="currentColor"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"/></svg>
    </button>
  </div>
</header>
<article class="article">
  <nav class="breadcrumb" aria-label="Breadcrumb">
    <a href="/index.html">Home</a> &gt;
    <a href="/curriculum/index.html">Curriculum</a> &gt;
    <a href="/curriculum/intermediate-bridge/index.html">Intermediate Bridge</a> &gt;
    <span>Lesson 47</span>
  </nav>

  <div class="lesson-badges">
    <span class="badge badge-lesson">LESSON 47</span>
    <span class="badge badge-tier-intermediatebridge">INTERMEDIATE BRIDGE</span>
    <span class="badge badge-time">~40 min</span>
  </div>

  <h1>Portfolio Construction: Building an Edge-Based System</h1>
  <p><b>Your edge isn't in ONE great trade‚Äîit's in how you allocate capital across HUNDREDS of trades.</b></p>
      <!-- Article Progress Indicator -->
      <div class="article-progress" style="--progress:0%">
        <div class="progress-circle"><span>0%</span></div>
        <div class="progress-text">
          <strong>You're making progress!</strong>
          <div style="font-size:.85rem;color:var(--muted)">Keep reading to mark this lesson complete</div>
        </div>
      </div>
  <p>Professional traders don't just find good setups. They build portfolios that maximize expected returns while controlling risk. This lesson teaches you how to construct a portfolio like an institutional fund manager.</p>

    
    
    
  </div>

  <div class="callout callout-success">
    <h4>üí∞ How Kelly Criterion Saved a $500K Account</h4>
    <p>A prop trader had a proven strategy: 58% win rate, avg win $450, avg loss $300. Using fixed 2% risk per trade, his annual return was 28% with 15% max drawdown.</p>
    <p><strong>The Optimization:</strong> He calculated optimal Kelly position sizing:</p>
    <ul>
      <li><strong>Kelly % = (Win% √ó Avg Win - Loss% √ó Avg Loss) / Avg Win</strong></li>
      <li>= (0.58 √ó $450 - 0.42 √ó $300) / $450 = 0.297 = 29.7% optimal risk</li>
      <li><strong>Half Kelly (safer):</strong> 29.7% / 2 = 14.9% ‚Üí rounded to 3% per trade</li>
    </ul>
    <p><strong>Results after 12 months:</strong></p>
    <ul>
      <li><strong>Old (2% fixed):</strong> +$140K profit, Sharpe 1.2, max DD 15%</li>
      <li><strong>New (3% Kelly):</strong> +$238K profit (+70% more), Sharpe 1.4, max DD 18%</li>
    </ul>
    <p><strong>Lesson:</strong> Kelly Criterion mathematically optimizes position sizing based on YOUR edge. Using it increased returns by 70% with only 3% more drawdown.</p>
  </div>

  <div class="callout-warning">
    <h4>üìâ CASE STUDY: Lisa's $91K Full Kelly Disaster (Apr-Jun 2024)</h4>

    <p><strong>Trader Profile:</strong> Lisa Chen, 34, swing trader (6 years experience), data scientist background</p>
    <p><strong>Account size:</strong> $175,000</p>
    <p><strong>Strategy:</strong> Mean reversion on oversold stocks, 5-7 day holds</p>
    <p><strong>Fatal flaw:</strong> Used FULL Kelly sizing based on small sample backtest (80 trades), didn't account for estimation error</p>

    <h5>The Disaster Timeline</h5>

    <p><strong>March 2024 - The Backtest:</strong> Lisa spent 2 months backtesting a mean reversion strategy on 80 historical trades. Results looked exceptional:</p>
    <ul>
      <li>Win rate: 55% (44 wins, 36 losses)</li>
      <li>Average win: $3,150</li>
      <li>Average loss: $1,750</li>
      <li>Win/loss ratio: 1.8</li>
      <li>Kelly % = (0.55 √ó 1.8 - 0.45) / 1.8 = 0.336 = 33.6%</li>
    </ul>
    <p>Lisa was a data scientist. She thought: "I calculated Kelly precisely. The math doesn't lie. I'll use FULL Kelly to maximize growth."</p>

    <p><strong>April 1, 2024 - First Live Trade (The Trap):</strong></p>
    <p>TSLA dropped -8% to $165 on Model Y price cuts. Lisa's algo flagged it as "oversold." Entry: $165, target: $180, stop: $157.</p>
    <p>Position size (Full Kelly): 33.6% of $175K = $58,800 / $8 risk per share = 7,350 shares.</p>
    <p><strong>Apr 3:</strong> TSLA drops to $159. Stopped out. <strong>Loss: -$44,100 (-25.2% of account in ONE trade)</strong>. Account: $175K ‚Üí $130,900.</p>

    <p><strong>Apr 8-May 20: The Death Spiral:</strong></p>
    <ul>
      <li><strong>Apr 8:</strong> NVDA pullback to $870. Full Kelly on $130,900 = 33.6% = $44K position. Lost. Account: $130,900 ‚Üí $97,600 (-25.4%).</li>
      <li><strong>Apr 22:</strong> AAPL oversold at $169. Full Kelly on $97,600 = $32,800 position. Small win (+$2,400). Account: $97,600 ‚Üí $100,000.</li>
      <li><strong>May 6:</strong> META dip to $455. Full Kelly = $33,600. Lost. Account: $100K ‚Üí $74,800 (-25.2%).</li>
      <li><strong>May 13:</strong> SPY pullback to $510. Full Kelly = $25,100. Lost. Account: $74,800 ‚Üí $56,000 (-25%).</li>
      <li><strong>May 20:</strong> GOOGL at $172. Full Kelly = $18,800. Won (+$3,100). Account: $56,000 ‚Üí $59,100.</li>
    </ul>

    <p><strong>10-week result:</strong> 12 trades, 3 wins (25% win rate), 9 losses. Started $175K, ended $59,100. <strong>Lost $115,900 (-66.2%)</strong>.</p>

    <p><strong>May 20, 11:38 PM - Journal Entry (The Breaking Point):</strong></p>
    <blockquote style="border-left: 4px solid #ff6b6b; padding: 1rem; background: rgba(255,107,107,0.1); margin: 1.5rem 0">
      "I don't understand. My backtest had 55% win rate. My live trading: 25%.

      Every loss is 25-33% of my account because I'm using full Kelly. After 3 losses in a row, I'm down 58%. After 5 losses, I'm down 75%. The compounding works AGAINST you on losses.

      I just realized: my backtest was 80 trades over 2 years. That's not enough data. Win rate 95% confidence interval: ¬±11%. My TRUE edge might be 44-66%, not 55%.

      If my real edge is 44% with 1.8 W/L, Kelly = only 6.7% (not 33.6%). I was overbetting by 5√ó because my sample size was too small.

      Full Kelly assumes you KNOW your edge precisely. I didn't. And it cost me $116K in 10 weeks."
    </blockquote>

    <h5>The Discovery: Fractional Kelly & Sample Size</h5>

    <p><strong>May 21-23:</strong> Lisa researched Kelly sizing mistakes. She learned:</p>
    <ol>
      <li><strong>Sample size error:</strong> 80 trades isn't enough. Need 200+ for stable edge estimation.</li>
      <li><strong>Full Kelly = Maximum volatility:</strong> Optimizes growth but creates 40-60% drawdowns.</li>
      <li><strong>Fractional Kelly:</strong> Quarter Kelly (0.25√ó) reduces volatility 75% while keeping 95% of growth.</li>
      <li><strong>Ed Thorp's rule:</strong> "Never use full Kelly. Use substantially less."</li>
      <li><strong>Overbet punishment:</strong> Betting 2√ó Kelly is WORSE than betting 0 (negative growth rate).</li>
    </ol>

    <h5>Recovery Framework</h5>

    <p><strong>Lisa's New System (Quarter Kelly):</strong></p>
    <ol>
      <li><strong>Larger Sample Backtest</strong> ‚Äì Expanded backtest to 220 trades. New results: 52% win rate (not 55%), 1.75 W/L (not 1.8). Adjusted Kelly: 28.6%.</li>
      <li><strong>Quarter Kelly Sizing</strong> ‚Äì 28.6% / 4 = 7.15% per trade. Conservative, accounts for estimation error.</li>
      <li><strong>Maximum Position Limit</strong> ‚Äì Never risk > 10% on single trade, even if Kelly says higher.</li>
      <li><strong>Drawdown Halt Rule</strong> ‚Äì If account drops > 20% from peak, reduce to Half Kelly (3.5%) until recovery.</li>
      <li><strong>Rolling Edge Calculation</strong> ‚Äì Recalculate win rate and W/L every 50 trades. Edge drifts with markets.</li>
      <li><strong>Confidence Interval Adjustment</strong> ‚Äì Use LOWER bound of 95% CI for win rate (conservative estimate).</li>
      <li><strong>Quarterly Strategy Review</strong> ‚Äì If win rate drops below 45% for 50+ trades, stop trading and revalidate edge.</li>
    </ol>

    <h5>Results: Before vs After</h5>

    <table style="width: 100%; border-collapse: collapse; margin: 1.5rem 0">
      <thead style="background: rgba(255,255,255,0.05)">
        <tr>
          <th style="padding: 0.75rem; text-align: left; border: 1px solid rgba(255,255,255,0.1)">Metric</th>
          <th style="padding: 0.75rem; text-align: left; border: 1px solid rgba(255,255,255,0.1)">Full Kelly (Apr-May)</th>
          <th style="padding: 0.75rem; text-align: left; border: 1px solid rgba(255,255,255,0.1)">Quarter Kelly (Jun-Dec)</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td style="padding: 0.75rem; border: 1px solid rgba(255,255,255,0.1)">Account Value</td>
          <td style="padding: 0.75rem; border: 1px solid rgba(255,255,255,0.1)">$175K ‚Üí $59.1K</td>
          <td style="padding: 0.75rem; border: 1px solid rgba(255,255,255,0.1)">$59.1K ‚Üí $98.7K</td>
        </tr>
        <tr>
          <td style="padding: 0.75rem; border: 1px solid rgba(255,255,255,0.1)">Win Rate</td>
          <td style="padding: 0.75rem; border: 1px solid rgba(255,255,255,0.1)">25% (3/12)</td>
          <td style="padding: 0.75rem; border: 1px solid rgba(255,255,255,0.1)">51% (38/74)</td>
        </tr>
        <tr>
          <td style="padding: 0.75rem; border: 1px solid rgba(255,255,255,0.1)">Avg Position Size</td>
          <td style="padding: 0.75rem; border: 1px solid rgba(255,255,255,0.1)">33.6% of account</td>
          <td style="padding: 0.75rem; border: 1px solid rgba(255,255,255,0.1)">7.15% of account</td>
        </tr>
        <tr>
          <td style="padding: 0.75rem; border: 1px solid rgba(255,255,255,0.1)">Largest Single Loss</td>
          <td style="padding: 0.75rem; border: 1px solid rgba(255,255,255,0.1)">-$44,100 (-25.2%)</td>
          <td style="padding: 0.75rem; border: 1px solid rgba(255,255,255,0.1)">-$5,240 (-7.1%)</td>
        </tr>
        <tr>
          <td style="padding: 0.75rem; border: 1px solid rgba(255,255,255,0.1)">Max Drawdown</td>
          <td style="padding: 0.75rem; border: 1px solid rgba(255,255,255,0.1)">-66.2%</td>
          <td style="padding: 0.75rem; border: 1px solid rgba(255,255,255,0.1)">-14.3%</td>
        </tr>
        <tr style="background: rgba(0,212,170,0.1)">
          <td style="padding: 0.75rem; border: 1px solid rgba(255,255,255,0.1)"><strong>Total P&L</strong></td>
          <td style="padding: 0.75rem; border: 1px solid rgba(255,255,255,0.1)"><strong>-$115,900 (-66.2%)</strong></td>
          <td style="padding: 0.75rem; border: 1px solid rgba(255,255,255,0.1)"><strong>+$39,600 (+67% from low)</strong></td>
        </tr>
      </tbody>
    </table>

    <h5>Lisa's Advice (In Her Own Words)</h5>

    <blockquote style="border-left: 4px solid #00d4aa; padding: 1rem; background: rgba(0,212,170,0.1); margin: 1.5rem 0">
      "I'm a data scientist. I thought I understood statistics. But I made the most basic error: small sample size.

      <strong>80 trades is NOT enough to estimate your edge.</strong> Standard error for 80 trades with 55% win rate = ¬±5.5%. That means your TRUE win rate could be 49.5-60.5%. If it's actually 49.5%, Kelly sizing blows up your account.

      <strong>Full Kelly is mathematically optimal only if you KNOW your edge precisely.</strong> You don't. None of us do. Market regimes change. Your backtest is always overfit. Use fractional Kelly.

      <strong>Quarter Kelly is the sweet spot:</strong> You get 95% of full Kelly's growth rate, but only 25% of the volatility. That 66% drawdown I suffered? With Quarter Kelly, it would've been 17%. Still alive.

      <strong>The Kelly formula doesn't account for estimation error.</strong> When textbooks say 'Kelly maximizes growth,' they assume you have a CASINO'S edge data (millions of trials). You have 80-200 trades. Adjust accordingly.

      <strong>My rule now:</strong> Backtest minimum 200 trades. Calculate Kelly. Divide by 4. Cap at 10% max. Recalculate every 50 trades. If edge degrades, STOP TRADING.

      I lost $116K because I trusted a formula without understanding its assumptions. Full Kelly works in theory. Fractional Kelly works in reality."
    </blockquote>

  </div>

  
      <!-- TL;DR Skimmer Summary -->
      <details style="background:rgba(0,212,170,0.08);padding:1.5rem;border-radius:8px;margin:2rem 0;border-left:4px solid #00d4aa">
        <summary style="cursor:pointer;font-weight:600;font-size:1.1rem">‚ö° TL;DR - 3-Minute Summary (Click to expand)</summary>
        <div style="margin-top:1rem">
          <h4 style="margin:0 0 0.75rem 0">üìã Lesson Concepts</h4>
          <ul style="line-height:1.8;margin:0 0 1rem 1.5rem">
            <li>Kelly Criterion: Optimal position size = (Edge √∑ Odds) where Edge = (WR √ó Avg Win) - (LR √ó Avg Loss)</li>
            <li>Never use full Kelly (too volatile)‚Äîuse 0.25-0.5√ó Kelly (fractional Kelly)</li>
            <li>Account for correlation: 3 strategies with 0.8 correlation = treat as 1 strategy for sizing</li>
            <li>Framework: Calculate Kelly for each strategy ‚Üí Use 0.25-0.5√ó ‚Üí Adjust down for correlations ‚Üí Rebalance monthly</li>
            <li>Common mistake: Using full Kelly = 50%+ drawdowns even with edge</li>
            <li>Validation: Half-Kelly provides 75% of full-Kelly growth with 50% of the volatility</li>
          </ul>
          <p style="margin-top:1rem;font-size:0.9rem;color:var(--muted)"><em>Read the full lesson for detailed case studies, trader stories with real P&L numbers, and step-by-step examples.</em></p>
        </div>
      </details>

      <div style="background:rgba(118,221,255,0.08);padding:1.5rem;border-radius:8px;margin:2rem 0;border-left:4px solid var(--accent)">
        <h3 style="margin:0 0 1rem 0">üéØ What You'll Learn</h3>
        <p style="margin:0 0 0.75rem 0">By the end of this lesson, you'll be able to:</p>
        <ul style="line-height:1.8;margin:0 0 0 1.5rem">
          <li>Kelly Criterion: Optimal position size = (Edge √∑ Odds) where Edge = (WR √ó Avg Win) - (LR √ó Avg Loss)</li>
          <li>Never use full Kelly (too volatile)</li>
          <li>Account for correlation: 3 strategies with 0.8 correlation = treat as 1 strategy for sizing</li>
          <li>Framework: Calculate Kelly for each strategy ‚Üí Use 0.25-0.5√ó ‚Üí Adjust down for correlations ‚Üí Rebalance monthly</li>
        </ul>
      </div>
      <!-- Prerequisites Warning -->
      <div class="callout-warning" style="margin:2rem 0;background:rgba(255,193,7,0.1);border-left:4px solid #ffc107">
        <h4>üìã Prerequisites</h4>
        <p>This lesson builds on concepts from:</p>
        <ul style="margin:0.5rem 0 0.75rem 1.5rem;line-height:1.8">
            <li><a href="/curriculum/beginner/01-the-liquidity-lie.html" style="color:#00d4aa;text-decoration:underline">Lesson 01: The Liquidity Lie</a> ‚Äî Understand institutional liquidity engineering</li>
            <li><a href="/curriculum/beginner/02-volume-doesnt-lie.html" style="color:#00d4aa;text-decoration:underline">Lesson 02: Volume Doesn't Lie</a> ‚Äî Master delta analysis and absorption patterns</li>
            <li><a href="/curriculum/beginner/03-price-action-is-dead.html" style="color:#00d4aa;text-decoration:underline">Lesson 03: Price Action is Dead</a> ‚Äî Learn order flow and tape reading basics</li>
        </ul>
        <p style="margin-top:0.75rem">‚úÖ If you've completed these, you're ready. Otherwise, start with the foundational lessons first.</p>
      </div>

<h2 id="part-1-portfolio-construction-philosophies">Part 1: Portfolio Construction Philosophies</h2>

  <h3>The Three Approaches</h3>
  
  <table>
    <thead>
      <tr>
        <th>Approach</th>
        <th>Goal</th>
        <th>Best For</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><strong>Equal Weight</strong></td>
        <td>Diversification</td>
        <td>Index tracking, passive strategies</td>
      </tr>
      <tr>
        <td><strong>Risk Parity</strong></td>
        <td>Equal risk contribution</td>
        <td>Multi-asset portfolios (stocks, bonds, commodities)</td>
      </tr>
      <tr>
        <td><strong>Kelly / Edge-Based</strong></td>
        <td>Maximize growth</td>
        <td>Active traders with proven edge</td>
      </tr>
    </tbody>
  </table>

  <h3>Equal Weight Portfolio</h3>
  <p><strong>Method:</strong> Allocate same $ amount to each position</p>
  <p><strong>Example:</strong> $100K portfolio, 10 positions ‚Üí $10K per position</p>
  <p><strong>Pros:</strong> Simple, prevents over-concentration</p>
  <p><strong>Cons:</strong> Ignores edge (treats high-conviction and low-conviction trades equally)</p>

  <h3>Risk Parity Portfolio</h3>
  <p><strong>Method:</strong> Allocate capital so each position contributes EQUAL risk</p>
  <p><strong>Example:</strong></p>
  <ul>
    <li>Stock A (high volatility): $5K position ‚Üí contributes $500 risk</li>
    <li>Stock B (low volatility): $15K position ‚Üí contributes $500 risk</li>
  </ul>
  <p><strong>Pros:</strong> Balances risk across uncorrelated assets</p>
  <p><strong>Cons:</strong> Can over-leverage low-vol assets (dangerous in regime shifts)</p>

  <h3>Kelly / Edge-Based Portfolio (Our Focus)</h3>
  <p><strong>Method:</strong> Size positions based on statistical edge (win rate √ó win/loss ratio)</p>
  <p><strong>Philosophy:</strong> Bet more when edge is higher, less when edge is lower</p>
  <p><strong>Pros:</strong> Mathematically optimal growth</p>
  <p><strong>Cons:</strong> Requires accurate edge estimation (garbage in, garbage out)</p>

  <h2 id="part-2-kelly-criterion-deep-dive">Part 2: Kelly Criterion Deep Dive</h2>

  <h3>The Kelly Formula</h3>
  <p><strong>f* = (p √ó b - q) / b</strong></p>
  <ul>
    <li><strong>f*:</strong> Optimal fraction of capital to risk</li>
    <li><strong>p:</strong> Win probability</li>
    <li><strong>q:</strong> Loss probability (1 - p)</li>
    <li><strong>b:</strong> Win/loss ratio (average win / average loss)</li>
  </ul>

  <div class="callout">
    <p><strong>üìö History:</strong> Kelly Criterion developed by John Kelly at Bell Labs (1956) for information theory, later applied to gambling and trading by Ed Thorp (Beat the Dealer, Beat the Market).</p>
  </div>

  <details class="accordion">
    <summary>Example: Applying Kelly to a Trading System</summary>
    <div class="accordion-content">
      <p><strong>Your backtested system stats:</strong></p>
      <ul>
        <li>Total trades: 200</li>
        <li>Wins: 110 (55%)</li>
        <li>Losses: 90 (45%)</li>
        <li>Average win: $600</li>
        <li>Average loss: $300</li>
      </ul>
      
      <p><strong>Step 1: Calculate inputs</strong></p>
      <ul>
        <li>p = 0.55 (win rate)</li>
        <li>q = 0.45 (loss rate)</li>
        <li>b = $600 / $300 = 2.0 (win/loss ratio)</li>
      </ul>

      <p><strong>Step 2: Apply Kelly formula</strong></p>
      <p>f* = (0.55 √ó 2 - 0.45) / 2 = (1.10 - 0.45) / 2 = 0.65 / 2 = 0.325</p>

      <p><strong>Step 3: Interpret</strong></p>
      <p>Kelly says: Risk 32.5% of capital per trade for maximum long-term growth</p>

      <p><strong>Step 4: Reality check</strong></p>
      <p>32.5% per trade = INSANE volatility (one 3-trade losing streak = -97% of capital)</p>
      <p><strong>Solution:</strong> Use fractional Kelly (most professionals use 0.25-0.5√ó Kelly)</p>
      <ul>
        <li><strong>Quarter Kelly:</strong> 32.5% / 4 = 8.1% per trade</li>
        <li><strong>Half Kelly:</strong> 32.5% / 2 = 16.3% per trade</li>
      </ul>
      <p><strong>Recommendation:</strong> 8-10% per trade (Quarter Kelly) for reasonable volatility</p>
    </div>
  </details>

  <h3>Why Full Kelly Is Too Aggressive</h3>
  <p><strong>Problem #1: Estimation error</strong></p>
  <ul>
    <li>Your 55% win rate might actually be 50% (sample size error)</li>
    <li>If true edge is lower than estimated, full Kelly over-bets ‚Üí ruin</li>
  </ul>

  <p><strong>Problem #2: Volatility</strong></p>
  <ul>
    <li>Full Kelly maximizes growth but creates 40-50% drawdowns</li>
    <li>Most traders can't psychologically handle that volatility</li>
  </ul>

  <p><strong>Problem #3: Non-independence</strong></p>
  <ul>
    <li>Kelly assumes each trade is independent (not true in trading)</li>
    <li>Losing streaks cluster (market regimes change, edge disappears temporarily)</li>
  </ul>

  <div class="callout">
    <p><strong>‚ö†Ô∏è Professional Consensus:</strong> Never use full Kelly. Use 0.25-0.5√ó Kelly for growth with manageable risk. Ed Thorp himself recommends "substantially less than Kelly."</p>
  </div>

  <div class="example-block">
    <h4>Real-World Example: 3 Position Sizing Methods Compared Over 100 Trades</h4>
    <p><strong>Trader:</strong> Swing trader with proven strategy, $100K starting capital</p>

    <p><strong>Strategy Stats (from 500-trade backtest):</strong></p>
    <ul>
      <li>Win rate: 58%</li>
      <li>Average win: $580</li>
      <li>Average loss: $320</li>
      <li>Win/loss ratio: 1.81</li>
      <li>Expectancy: (0.58 √ó $580) - (0.42 √ó $320) = $336.40 - $134.40 = $202 per trade</li>
    </ul>

    <p><strong>Kelly Calculation:</strong></p>
    <ul>
      <li>f* = (p √ó b - q) / b = (0.58 √ó 1.81 - 0.42) / 1.81 = 0.349 = 34.9%</li>
      <li>Half Kelly = 17.5%</li>
      <li>Quarter Kelly = 8.7%</li>
    </ul>

    <p><strong>Three Position Sizing Methods Tested:</strong></p>

    <table>
      <thead>
        <tr>
          <th>Method</th>
          <th>Position Sizing Rule</th>
          <th>Rationale</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><strong>Method A: Fixed 1%</strong></td>
          <td>Risk 1% of account per trade</td>
          <td>Conservative, standard retail approach</td>
        </tr>
        <tr>
          <td><strong>Method B: Half Kelly</strong></td>
          <td>Risk 17.5% / 10 = 1.75% per trade</td>
          <td>Balanced growth/risk (divided by 10 for safety)</td>
        </tr>
        <tr>
          <td><strong>Method C: Full Kelly</strong></td>
          <td>Risk 34.9% / 10 = 3.5% per trade</td>
          <td>Maximum growth (for comparison only)</td>
        </tr>
      </tbody>
    </table>

    <p><strong>Results After 100 Trades (same trade sequence):</strong></p>

    <h5>Method A: Fixed 1% Risk</h5>
    <table>
      <thead>
        <tr>
          <th>Metric</th>
          <th>Value</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>Starting Capital</td>
          <td>$100,000</td>
        </tr>
        <tr>
          <td>Ending Capital</td>
          <td>$118,450</td>
        </tr>
        <tr>
          <td>Total Return</td>
          <td>+18.5%</td>
        </tr>
        <tr>
          <td>Max Drawdown</td>
          <td>-8.2%</td>
        </tr>
        <tr>
          <td>Sharpe Ratio</td>
          <td>1.2</td>
        </tr>
        <tr>
          <td>Largest Loss</td>
          <td>-$1,180</td>
        </tr>
        <tr>
          <td>Longest Losing Streak</td>
          <td>7 trades</td>
        </tr>
      </tbody>
    </table>

    <h5>Method B: Half Kelly (1.75% Risk)</h5>
    <table>
      <thead>
        <tr>
          <th>Metric</th>
          <th>Value</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>Starting Capital</td>
          <td>$100,000</td>
        </tr>
        <tr>
          <td>Ending Capital</td>
          <td>$134,280</td>
        </tr>
        <tr>
          <td>Total Return</td>
          <td>+34.3%</td>
        </tr>
        <tr>
          <td>Max Drawdown</td>
          <td>-12.8%</td>
        </tr>
        <tr>
          <td>Sharpe Ratio</td>
          <td>1.6</td>
        </tr>
        <tr>
          <td>Largest Loss</td>
          <td>-$2,245</td>
        </tr>
        <tr>
          <td>Longest Losing Streak</td>
          <td>7 trades (same, but bigger $)</td>
        </tr>
      </tbody>
    </table>

    <h5>Method C: Full Kelly (3.5% Risk) - FOR COMPARISON ONLY</h5>
    <table>
      <thead>
        <tr>
          <th>Metric</th>
          <th>Value</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>Starting Capital</td>
          <td>$100,000</td>
        </tr>
        <tr>
          <td>Ending Capital</td>
          <td>$152,900</td>
        </tr>
        <tr>
          <td>Total Return</td>
          <td>+52.9%</td>
        </tr>
        <tr>
          <td>Max Drawdown</td>
          <td><strong>-21.4%</strong> (brutal)</td>
        </tr>
        <tr>
          <td>Sharpe Ratio</td>
          <td>1.3 (worse than Half Kelly!)</td>
        </tr>
        <tr>
          <td>Largest Loss</td>
          <td>-$5,120</td>
        </tr>
        <tr>
          <td>Longest Losing Streak</td>
          <td>7 trades, -$18,450 total</td>
        </tr>
      </tbody>
    </table>

    <p><strong>Comparison Summary:</strong></p>
    <table>
      <thead>
        <tr>
          <th>Method</th>
          <th>Return</th>
          <th>Max DD</th>
          <th>Sharpe</th>
          <th>Return/DD Ratio</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>Fixed 1%</td>
          <td>+18.5%</td>
          <td>-8.2%</td>
          <td>1.2</td>
          <td>2.3</td>
        </tr>
        <tr>
          <td><strong>Half Kelly</strong></td>
          <td><strong>+34.3%</strong></td>
          <td>-12.8%</td>
          <td><strong>1.6 (best)</strong></td>
          <td><strong>2.7 (best)</strong></td>
        </tr>
        <tr>
          <td>Full Kelly</td>
          <td>+52.9%</td>
          <td><strong>-21.4%</strong></td>
          <td>1.3</td>
          <td>2.5</td>
        </tr>
      </tbody>
    </table>

    <p><strong>Key Insights:</strong></p>

    <ol>
      <li><strong>Half Kelly delivered best risk-adjusted returns:</strong>
        <ul>
          <li>85% more profit than fixed 1% (+34.3% vs +18.5%)</li>
          <li>Only 56% more drawdown (-12.8% vs -8.2%)</li>
          <li>Highest Sharpe ratio (1.6) = most efficient growth</li>
        </ul>
      </li>
      <li><strong>Full Kelly had highest return but unsustainable risk:</strong>
        <ul>
          <li>186% more profit than fixed 1% (+52.9% vs +18.5%)</li>
          <li>But 161% more drawdown (-21.4% vs -8.2%)</li>
          <li>Losing streak cost -$18K (would scare most traders into quitting)</li>
          <li>Lower Sharpe than Half Kelly (1.3 vs 1.6) = inefficient volatility</li>
        </ul>
      </li>
      <li><strong>Fixed 1% was "safe" but left massive profit on table:</strong>
        <ul>
          <li>Account ended at $118K vs $134K (Half Kelly) = $16K missed profit</li>
          <li>Over 5 years, this compounds to 6-figure difference</li>
        </ul>
      </li>
    </ol>

    <p><strong>What Happened During the 7-Trade Losing Streak (Trade #45-51):</strong></p>

    <table>
      <thead>
        <tr>
          <th>Trade #</th>
          <th>Fixed 1%</th>
          <th>Half Kelly</th>
          <th>Full Kelly</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>Account before streak</td>
          <td>$108,200</td>
          <td>$121,500</td>
          <td>$138,400</td>
        </tr>
        <tr>
          <td>Loss #1</td>
          <td>-$1,082</td>
          <td>-$2,126</td>
          <td>-$4,844</td>
        </tr>
        <tr>
          <td>Loss #2</td>
          <td>-$1,071</td>
          <td>-$2,089</td>
          <td>-$4,675</td>
        </tr>
        <tr>
          <td>Loss #3</td>
          <td>-$1,060</td>
          <td>-$2,052</td>
          <td>-$4,511</td>
        </tr>
        <tr>
          <td>Loss #4</td>
          <td>-$1,049</td>
          <td>-$2,016</td>
          <td>-$4,353</td>
        </tr>
        <tr>
          <td>Loss #5</td>
          <td>-$1,038</td>
          <td>-$1,981</td>
          <td>-$4,201</td>
        </tr>
        <tr>
          <td>Loss #6</td>
          <td>-$1,027</td>
          <td>-$1,947</td>
          <td>-$4,054</td>
        </tr>
        <tr>
          <td>Loss #7</td>
          <td>-$1,017</td>
          <td>-$1,913</td>
          <td>-$3,912</td>
        </tr>
        <tr>
          <td><strong>Total streak loss</strong></td>
          <td><strong>-$7,344 (-6.8%)</strong></td>
          <td><strong>-$14,124 (-11.6%)</strong></td>
          <td><strong>-$30,550 (-22.1%)</strong></td>
        </tr>
        <tr>
          <td>Account after streak</td>
          <td>$100,856</td>
          <td>$107,376</td>
          <td>$107,850</td>
        </tr>
      </tbody>
    </table>

    <p><strong>The Psychology Test:</strong></p>
    <ul>
      <li><strong>Fixed 1%:</strong> Lost $7,344 over 7 trades. Uncomfortable but tolerable.</li>
      <li><strong>Half Kelly:</strong> Lost $14,124 over 7 trades. Painful but if you trust your edge, you stick with it.</li>
      <li><strong>Full Kelly:</strong> Lost $30,550 over 7 trades (-22% of peak!). Most traders would panic, abandon system, or reduce size drastically. This is why full Kelly fails in practice‚Äîhumans can't psychologically handle the swings.</li>
    </ul>

    <p><strong>Final Recommendation:</strong></p>
    <ul>
      <li><strong>Conservative traders:</strong> 0.5-1.0% fixed risk (safe, steady)</li>
      <li><strong>Proven edge + discipline:</strong> Quarter Kelly (0.25√ó Kelly calculation)</li>
      <li><strong>Experienced + high risk tolerance:</strong> Half Kelly (0.5√ó Kelly calculation)</li>
      <li><strong>NEVER use full Kelly</strong> unless you're a robot with no emotions</li>
    </ul>
  </div>

  <h2 id="part-3-multi-position-kelly-portfolio-optimization">Part 3: Multi-Position Kelly (Portfolio Optimization)</h2>

  <h3>The Portfolio Kelly Problem</h3>
  <p><strong>Question:</strong> You have 5 different setups with different edges. How much to allocate to each?</p>

  <table>
    <thead>
      <tr>
        <th>Setup</th>
        <th>Win Rate</th>
        <th>Win/Loss</th>
        <th>Kelly %</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>Breakout</td>
        <td>45%</td>
        <td>3.0</td>
        <td>27.5%</td>
      </tr>
      <tr>
        <td>Mean Reversion</td>
        <td>65%</td>
        <td>1.2</td>
        <td>37.5%</td>
      </tr>
      <tr>
        <td>Trend Following</td>
        <td>40%</td>
        <td>4.0</td>
        <td>30.0%</td>
      </tr>
      <tr>
        <td>Gap Fade</td>
        <td>70%</td>
        <td>1.0</td>
        <td>40.0%</td>
      </tr>
      <tr>
        <td>Order Flow</td>
        <td>60%</td>
        <td>1.5</td>
        <td>33.3%</td>
      </tr>
    </tbody>
  </table>

  <p><strong>Problem:</strong> Sum of Kelly % = 168.3% (over-leveraged!)</p>

  <h3>Solution: Correlation-Adjusted Kelly</h3>
  <p><strong>Key insight:</strong> If setups are correlated, reduce allocation (they're the same bet)</p>
  
  <details class="accordion">
    <summary>Adjusting for Correlation</summary>
    <div class="accordion-content">
      <p><strong>Example:</strong></p>
      <ul>
        <li>Breakout strategy Kelly = 27.5%</li>
        <li>Trend Following strategy Kelly = 30.0%</li>
        <li>Correlation between strategies = 0.7 (high)</li>
      </ul>

      <p><strong>Naive allocation:</strong> 27.5% + 30% = 57.5% total</p>

      <p><strong>Correlation-adjusted allocation:</strong></p>
      <p>Adjusted = Individual Kelly √ó (1 - correlation factor)</p>
      <p>Breakout: 27.5% √ó (1 - 0.35) = 17.9%</p>
      <p>Trend: 30.0% √ó (1 - 0.35) = 19.5%</p>
      <p><strong>Total: 37.4%</strong> (vs 57.5% naive)</p>

      <p><strong>Result:</strong> Reduced over-leverage by accounting for strategies betting on same market behavior</p>
    </div>
  </details>

  <h3>Practical Portfolio Allocation</h3>
  <p><strong>Step 1:</strong> Calculate Kelly % for each strategy (use quarter/half Kelly)</p>
  <p><strong>Step 2:</strong> Identify correlations (which strategies win/lose together?)</p>
  <p><strong>Step 3:</strong> Reduce allocation to correlated strategies</p>
  <p><strong>Step 4:</strong> Cap total portfolio leverage at 100% (or your risk tolerance)</p>

  <h2 id="part-4-dynamic-position-sizing">Part 4: Dynamic Position Sizing</h2>

  <h3>Fixed-Fraction vs Dynamic Kelly</h3>
  <p><strong>Fixed-Fraction:</strong> Always risk same % (e.g., 1% per trade)</p>
  <p><strong>Dynamic Kelly:</strong> Adjust size based on recent performance</p>

  <h3>Equity Curve Trading</h3>
  <p><strong>Concept:</strong> Increase size when winning, decrease when losing</p>
  <p><strong>Method:</strong></p>
  <ul>
    <li>Calculate 20-day moving average of equity curve</li>
    <li>If equity &gt; MA: Increase position size by 25% (edge working)</li>
    <li>If equity &lt; MA: Decrease position size by 50% (edge broken or regime shift)</li>
  </ul>

  <p><strong>Benefit:</strong> Automatically scales risk to match performance (compound winners, limit losers)</p>

  <details class="accordion">
    <summary>Example: Equity Curve Position Adjustment</summary>
    <div class="accordion-content">
      <p><strong>Baseline:</strong> Account = $100K, Standard risk = 1% = $1,000/trade</p>

      <p><strong>Scenario 1: Hot streak (equity &gt; 20-day MA)</strong></p>
      <ul>
        <li>Account now: $108K</li>
        <li>Equity &gt; MA (trending up)</li>
        <li>Adjusted risk: 1% √ó 1.25 = 1.25%</li>
        <li>Risk per trade: $108K √ó 1.25% = $1,350</li>
      </ul>

      <p><strong>Scenario 2: Cold streak (equity &lt; 20-day MA)</strong></p>
      <ul>
        <li>Account now: $97K</li>
        <li>Equity &lt; MA (trending down)</li>
        <li>Adjusted risk: 1% √ó 0.5 = 0.5%</li>
        <li>Risk per trade: $97K √ó 0.5% = $485</li>
      </ul>

      <p><strong>Result:</strong> Risk more when edge is working, less when it's not (dynamic adaptation)</p>
    </div>
  </details>

  <h2 id="part-5-using-signal-pilot-for-portfolio-construction">Part 5: Using Signal Pilot for Portfolio Construction</h2>

  <h3>Janus Atlas: Multi-Strategy Overlay</h3>
  <p><strong>Feature:</strong> Visualize all active strategies on same chart (identify correlation)</p>
  <p><strong>Use case:</strong> If all your setups trigger on same day ‚Üí high correlation ‚Üí reduce total size</p>

  <h3>Pentarch Pilot Line: Edge Validation</h3>
  <p><strong>Feature:</strong> Compare your entries vs institutional flow</p>
  <p><strong>Signal:</strong> If Pilot Line confirms your setup (institutional flow aligned) ‚Üí increase size to Kelly %</p>
  <p><strong>Warning:</strong> If Pilot Line contradicts setup (institutions selling, you buying) ‚Üí reduce size to 0.5√ó Kelly</p>

  <h3>Harmonic Oscillator: Regime Detection for Sizing</h3>
  <p><strong>Feature:</strong> Identify trending vs mean-reverting regimes</p>
  <p><strong>Application:</strong> Increase potential breakout strategy allocation in trending regime, increase mean-reversion allocation in ranging regime</p>

  <h2 id="quiz-test-your-understanding">Quiz: Test Your Understanding</h2>
  <div class="quiz">
    <div class="quiz-question">
      <p><strong>Q1:</strong> Your system: 60% win rate, $400 avg win, $200 avg loss. What's the Kelly %?</p>
      <details>
        <summary>Show Answer</summary>
        <p><strong>Answer:</strong> p = 0.6, q = 0.4, b = $400/$200 = 2. Kelly = (0.6 √ó 2 - 0.4) / 2 = (1.2 - 0.4) / 2 = 0.4 = 40%. But use quarter Kelly (10%) or half Kelly (20%) in practice to reduce volatility.</p>
      </details>
    </div>

    <div class="quiz-question">
      <p><strong>Q2:</strong> You have 3 strategies with Kelly %: 20%, 25%, 30%. Correlation = 0.8. Should you allocate 75% total?</p>
      <details>
        <summary>Show Answer</summary>
        <p><strong>Answer:</strong> No. High correlation (0.8) means strategies are essentially the same bet. Reduce each allocation by ~30-40% to account for correlation. Adjusted total: ~45-50%, not 75%. Otherwise you're over-leveraged to one market regime.</p>
      </details>
    </div>

    <div class="quiz-question">
      <p><strong>Q3:</strong> Your equity curve drops below its 20-day MA. What should you do with position sizing?</p>
      <details>
        <summary>Show Answer</summary>
        <p><strong>Answer:</strong> Reduce position size by 50% (cut risk from 1% to 0.5% per trade). Equity below MA signals your edge may be impaired or market regime has shifted. Protect capital until equity crosses back above MA, then resume normal sizing.</p>
      </details>
    </div>
  </div>

  <h2 id="practical-checklist">Practical Checklist</h2>
  <div class="checklist">
    <h4>Portfolio Construction Workflow:</h4>
    <ul>
      <li>Backtest each strategy: Calculate win rate, win/loss ratio</li>
      <li>Calculate Kelly % for each strategy (use quarter or half Kelly)</li>
      <li>Identify correlation between strategies (do they win/lose together?)</li>
      <li>Reduce allocation to highly correlated strategies (correlation &gt;0.6)</li>
      <li>Cap total portfolio allocation at 100% (or your risk tolerance)</li>
      <li>Implement equity curve tracking (20-day MA)</li>
      <li>Adjust sizing based on equity vs MA (increase when above, decrease when below)</li>
    </ul>
    <h4>Pre-Trade Kelly Check:</h4>
    <ul>
      <li>Identify which strategy this setup belongs to</li>
      <li>Check remaining allocation for that strategy (have you hit Kelly limit?)</li>
      <li>Check portfolio heat: Total risk across all positions &lt; 10%?</li>
      <li>Use Signal Pilot Pentarch Pilot Line to confirm edge (institutional flow aligned?)</li>
      <li>If edge confirmed, use full (quarter/half) Kelly. If not, use 0.5√ó Kelly or skip</li>
    </ul>
  </div>

  <div class="key-takeaway">
    <h4>Key Takeaways</h4>
    <ul>
      <li><strong>Kelly Criterion mathematically optimizes sizing</strong> based on edge (win rate √ó win/loss ratio)</li>
      <li><strong>Never use full Kelly</strong> (too volatile) ‚Äî use 0.25-0.5√ó Kelly</li>
      <li><strong>Correlation matters:</strong> Reduce allocation to correlated strategies (they're the same bet)</li>
      <li><strong>Dynamic sizing:</strong> Increase when equity &gt; MA, decrease when &lt; MA</li>
      <li><strong>Portfolio heat cap:</strong> Total risk across all positions should never exceed 10%</li>
      <li><strong>Overconfidence kills accounts:</strong> Even with a proven 60% win rate and 2:1 R:R (20% full Kelly), a 7-trade losing streak happens ~1.6% of the time (1-2 times per year with 100 trades/year). Full Kelly would lose 22% of your account in that streak. Quarter Kelly loses only 4-5%. The math says "bet big," but psychology says "survive to trade tomorrow." Always fractional Kelly.</li>
    </ul>
  </div>

  <div class="related-lessons">
    <h4>Related Lessons</h4>
    <ul>
      <li><a href="46-advanced-risk-management.html">Lesson 46: Advanced Risk Management</a></li>
      <li><a href="20-swing-trading-framework.html">Lesson 20: Swing Trading Framework</a></li>
      <li><a href="/curriculum/advanced-mastery/66-quantitative-strategy-design.html">Lesson 66: Quantitative Strategy Design</a></li>
    </ul>
  </div>

  <div class="downloads">
    <h4>Downloads</h4>
    <ul>
      <li><a href="/downloads/kelly-calculator.xlsx">Kelly Criterion Calculator (Excel)</a></li>
      <li><a href="/downloads/portfolio-allocation-tracker.xlsx">Portfolio Allocation Tracker (Excel)</a></li>
      <li><a href="/downloads/equity-curve-monitor.xlsx">Equity Curve Monitor (Excel)</a></li>
    </ul>
  </div>
</article>
    <aside class="toc" aria-label="On this page">
      <h3 id="on-this-page">On this page</h3>
      <a href="#part-1-portfolio-construction-philosophies">Part 1: Portfolio Construction Philosophies</a>
      <a href="#part-2-kelly-criterion-deep-dive">Part 2: Kelly Criterion Deep Dive</a>
      <a href="#part-3-multi-position-kelly-portfolio-optimization">Part 3: Multi-Position Kelly (Portfolio Optimization)</a>
      <a href="#part-4-dynamic-position-sizing">Part 4: Dynamic Position Sizing</a>
      <a href="#part-5-using-signal-pilot-for-portfolio-construction">Part 5: Using Signal Pilot for Portfolio Construction</a>
      <a href="#quiz-test-your-understanding">Quiz: Test Your Understanding</a>
      <a href="#practical-checklist">Practical Checklist</a>
    </aside>
<footer class="sp-footer">
  <div class="container">
    <p>&copy; 2025 Signal Pilot Labs, Inc. All rights reserved.</p>
  </div>
</footer>
<script src="/assets/edu.js"></script>
<script src="/assets/edu-enhanced.js"></script>
<script src="/assets/toc-active.js"></script>
<script>
document.getElementById('theme-toggle')?.addEventListener('click', () => {
  const html = document.documentElement;
  const currentTheme = html.getAttribute('data-theme');
  html.setAttribute('data-theme', currentTheme === 'dark' ? 'light' : 'dark');
});
const canvas = document.getElementById('constellations');
if (canvas) {
  const ctx = canvas.getContext('2d');
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
  const stars = Array.from({ length: 80 }, () => ({
    x: Math.random() * canvas.width,
    y: Math.random() * canvas.height,
    vx: (Math.random() - 0.5) * 0.2,
    vy: (Math.random() - 0.5) * 0.2
  }));
  function drawConstellations() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.strokeStyle = 'rgba(139, 92, 246, 0.15)';
    ctx.lineWidth = 1;
    for (let i = 0; i < stars.length; i++) {
      for (let j = i + 1; j < stars.length; j++) {
        const dx = stars[i].x - stars[j].x;
        const dy = stars[i].y - stars[j].y;
        const dist = Math.sqrt(dx * dx + dy * dy);
        if (dist < 150) {
          ctx.beginPath();
          ctx.moveTo(stars[i].x, stars[i].y);
          ctx.lineTo(stars[j].x, stars[j].y);
          ctx.stroke();
        }
      }
      stars[i].x += stars[i].vx;
      stars[i].y += stars[i].vy;
      if (stars[i].x < 0 || stars[i].x > canvas.width) stars[i].vx *= -1;
      if (stars[i].y < 0 || stars[i].y > canvas.height) stars[i].vy *= -1;
    }
    requestAnimationFrame(drawConstellations);
  }
  drawConstellations();
  window.addEventListener('resize', () => {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
  });
}
</script>
  <!-- Enhanced Analytics & A/B Testing -->
  <script src="/assets/enhanced-analytics.js" defer></script>
  <script src="/assets/ab-test-tldr.js" defer></script>
</body>
</html>